<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/index.css">
  </head>
  <body>
    <div id="skills" class="progress-skills">
      <button class="progress-skill__time-date" data-group="d" type="button">
        <small data-unit="w">Sunday</small><br />
        <span data-unit="mo">January</span>
        <span data-unit="d">1</span>
      </button>
      <button
        class="progress-skill__time-digit"
        data-unit="h"
        data-group="h"
        type="button"
      ></button
      ><span class="progress-skill__time-colon"></span
      ><button
        class="progress-skill__time-digit"
        data-unit="m"
        data-group="m"
        type="button"
      ></button
      ><span class="progress-skill__time-colon"></span
      ><button
        class="progress-skill__time-digit"
        data-unit="s"
        data-group="s"
        type="button"
      ></button>
      <span class="progress-skill__time-ampm" data-unit="ap">AM</span>
      <svg
        class="progress-skill__rings"
        width="256"
        height="256"
        viewBox="0 0 256 256"
      >
        <defs>
          <linearGradient id="pc-red" x1="1" y1="0.5" x2="0" y2="0.5">
            <stop offset="0%" stop-color="hsl(13,90%,78%)" />
            <stop offset="100%" stop-color="hsl(13,90%,55%)" />
          </linearGradient>
          <linearGradient id="pc-yellow" x1="1" y1="0.5" x2="0" y2="0.5">
            <stop offset="0%" stop-color="hsl(43,90%,75%)" />
            <stop offset="100%" stop-color="hsl(23,90%,55%)" />
          </linearGradient>
          <linearGradient id="pc-blue" x1="1" y1="0.5" x2="0" y2="0.5">
            <stop offset="0%" stop-color="hsl(223,90%,55%)" />
            <stop offset="100%" stop-color="hsl(203,90%,55%)" />
          </linearGradient>
          <linearGradient id="pc-purple" x1="1" y1="0.5" x2="0" y2="0.5">
            <stop offset="0%" stop-color="hsl(283,90%,55%)" />
            <stop offset="100%" stop-color="hsl(263,90%,55%)" />
          </linearGradient>
        </defs>
        <!-- Days of Month -->
        <g data-units="d">
          <circle
            class="progress-skill__ring"
            cx="128"
            cy="128"
            r="74"
            fill="none"
            opacity="0.1"
            stroke="url(#pc-red)"
            stroke-width="12"
          />
          <circle
            class="progress-skill__ring-fill"
            data-ring="mo"
            cx="128"
            cy="128"
            r="74"
            fill="none"
            stroke="url(#pc-red)"
            stroke-width="12"
            stroke-dasharray="465 465"
            stroke-dashoffset="465"
            stroke-linecap="round"
            transform="rotate(-90,128,128)"
          />
        </g>
        <!-- Hours of Day -->
        <g data-units="h">
          <circle
            class="progress-skill__ring"
            cx="128"
            cy="128"
            r="90"
            fill="none"
            opacity="0.1"
            stroke="url(#pc-yellow)"
            stroke-width="12"
          />
          <circle
            class="progress-skill__ring-fill"
            data-ring="d"
            cx="128"
            cy="128"
            r="90"
            fill="none"
            stroke="url(#pc-yellow)"
            stroke-width="12"
            stroke-dasharray="565.5 565.5"
            stroke-dashoffset="565.5"
            stroke-linecap="round"
            transform="rotate(-90,128,128)"
          />
        </g>
        <!-- Minutes of Hour -->
        <g data-units="m">
          <circle
            class="progress-skill__ring"
            cx="128"
            cy="128"
            r="106"
            fill="none"
            opacity="0.1"
            stroke="url(#pc-blue)"
            stroke-width="12"
          />
          <circle
            class="progress-skill__ring-fill"
            data-ring="h"
            cx="128"
            cy="128"
            r="106"
            fill="none"
            stroke="url(#pc-blue)"
            stroke-width="12"
            stroke-dasharray="666 666"
            stroke-dashoffset="666"
            stroke-linecap="round"
            transform="rotate(-90,128,128)"
          />
        </g>
        <!-- Seconds of Minute -->
        <g data-units="s">
          <circle
            class="progress-skill__ring"
            cx="128"
            cy="128"
            r="122"
            fill="none"
            opacity="0.1"
            stroke="url(#pc-purple)"
            stroke-width="12"
          />
          <circle
            class="progress-skill__ring-fill"
            data-ring="m"
            cx="128"
            cy="128"
            r="122"
            fill="none"
            stroke="url(#pc-purple)"
            stroke-width="12"
            stroke-dasharray="766.5 766.5"
            stroke-dashoffset="766.5"
            stroke-linecap="round"
            transform="rotate(-90,128,128)"
          />
        </g>
      </svg>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const skills = new ProgressSkills("#skills");
      });

      class ProgressSkills {
        constructor(qs) {
          this.el = document.querySelector(qs);
          this.time = 0;
          this.updateTimeout = null;
          this.ringTimeouts = [];
          this.update();
        }
        update() {
          this.time = new Date();

          if (this.el) {
            // circle progress
            const m_progress = 0.6;
            const h_progress = 0.8;
            const d_progress = 0.7;
            const mo_progress = 0.9;
            const units = [
              {
                label: "w",
                value: "Front-End",
              },
              {
                label: "mo",
                value: "",
                progress: mo_progress,
              },
              {
                label: "d",
                value: "",
                progress: d_progress,
              },
              {
                label: "h",
                value: "Data Base",
                progress: h_progress,
              },
              {
                label: "m",
                value: "Soft-Skills",
                progress: m_progress,
              },
              {
                label: "s",
                value: "Cross Platform",
              },
              {
                label: "ap",
                value: "",
              },
            ];

            // flush out the timeouts
            this.ringTimeouts.forEach((t) => {
              clearTimeout(t);
            });
            this.ringTimeouts = [];

            // update the display
            units.forEach((u) => {
              // rings
              const ring = this.el.querySelector(`[data-ring="${u.label}"]`);

              if (ring) {
                const strokeDashArray = ring.getAttribute("stroke-dasharray");
                const fill360 = "progress-skill__ring-fill--360";

                if (strokeDashArray) {
                  // calculate the stroke
                  const circumference = +strokeDashArray.split(" ")[0];
                  const strokeDashOffsetPct = 1 - u.progress;

                  ring.setAttribute(
                    "stroke-dashoffset",
                    strokeDashOffsetPct * circumference
                  );

                  // add the fade-out transition, then remove it
                  if (strokeDashOffsetPct === 1) {
                    ring.classList.add(fill360);

                    this.ringTimeouts.push(
                      setTimeout(() => {
                        ring.classList.remove(fill360);
                      }, 600)
                    );
                  }
                }
              }

              // digits
              const unit = this.el.querySelector(`[data-unit="${u.label}"]`);

              if (unit) unit.innerText = u.value;
            });
          }

          clearTimeout(this.updateTimeout);
          this.updateTimeout = setTimeout(this.update.bind(this), 1e3);
        }
      }
    </script>
  </body>
</html>
